#define KERNEL_DATA_SEG $16

.macro Handler IntrNum,EndFunc,HasErrorCode
.global AsmHandler\IntrNum
AsmHandler\IntrNum:
	//xchg %bx,%bx
.if \HasErrorCode
.else
	pushl $0    /*若没有ErrorCode 那么ErrorCode就应该是0*/ 
.endif
	pushl $\IntrNum   /*把中断号压栈*/ 
	pushal
	
	pushl %ds
	pushl %es
	pushl %fs
	pushl %gs

	xorl %ebx,%ebx
	movw %ds,%ax
	movzx %ax,%eax
	bt $2,%eax
	setnc %bl
	pushl %ebx    /*Kernel or User?*/ 


	movw KERNEL_DATA_SEG,%ax
	movw %ax,%ds
	movw %ax,%es
	movw %ax,%ss

	
	call \EndFunc

	addl $4,%esp

	popl %gs
	popl %fs
	popl %es
	popl %ds
	popal

	addl $8,%esp
	
	iret
.endm
.extern CHandler

/*.macro HandlerNoError IntrNum,EndFunc,HasErrorCode*/
/*

print(".section \".text\"")
for i in range(0,21):
	print("Handler %d,CHandler,1" % i)
for i in range(21,256):
	print("Handler %d,CHandler,0" % i) 
print(".section \".data\"")
print(".global ItrnTable")
print(".align 4096")
print("ItrnTable:")
for i in range(0,256):
	print(".long $AsmHandler%d" % i)
	print(".long 0")

*/
.section ".text"
Handler 0,CHandler,1
Handler 1,CHandler,0			 /*Debug intr has no errorcode*/ 
Handler 2,CHandler,1
Handler 3,CHandler,1
Handler 4,CHandler,1
Handler 5,CHandler,1
Handler 6,CHandler,1
Handler 7,CHandler,1
Handler 8,CHandler,0
Handler 9,CHandler,1
Handler 10,CHandler,1
Handler 11,CHandler,1
Handler 12,CHandler,1
Handler 13,CHandler,1
Handler 14,CHandler,1
Handler 15,CHandler,1
Handler 16,CHandler,1
Handler 17,CHandler,1
Handler 18,CHandler,1
Handler 19,CHandler,1
Handler 20,CHandler,1
Handler 21,CHandler,0
Handler 22,CHandler,0
Handler 23,CHandler,0
Handler 24,CHandler,0
Handler 25,CHandler,0
Handler 26,CHandler,0
Handler 27,CHandler,0
Handler 28,CHandler,0
Handler 29,CHandler,0
Handler 30,CHandler,0
Handler 31,CHandler,0
Handler 32,CHandler,0
Handler 33,CHandler,0
Handler 34,CHandler,0
Handler 35,CHandler,0
Handler 36,CHandler,0
Handler 37,CHandler,0
Handler 38,CHandler,0
Handler 39,CHandler,0
Handler 40,CHandler,0
Handler 41,CHandler,0
Handler 42,CHandler,0
Handler 43,CHandler,0
Handler 44,CHandler,0
Handler 45,CHandler,0
Handler 46,CHandler,0
Handler 47,CHandler,0
Handler 48,CHandler,0
Handler 49,CHandler,0
Handler 50,CHandler,0
Handler 51,CHandler,0
Handler 52,CHandler,0
Handler 53,CHandler,0
Handler 54,CHandler,0
Handler 55,CHandler,0
Handler 56,CHandler,0
Handler 57,CHandler,0
Handler 58,CHandler,0
Handler 59,CHandler,0
Handler 60,CHandler,0
Handler 61,CHandler,0
Handler 62,CHandler,0
Handler 63,CHandler,0
Handler 64,CHandler,0
Handler 65,CHandler,0
Handler 66,CHandler,0
Handler 67,CHandler,0
Handler 68,CHandler,0
Handler 69,CHandler,0
Handler 70,CHandler,0
Handler 71,CHandler,0
Handler 72,CHandler,0
Handler 73,CHandler,0
Handler 74,CHandler,0
Handler 75,CHandler,0
Handler 76,CHandler,0
Handler 77,CHandler,0
Handler 78,CHandler,0
Handler 79,CHandler,0
Handler 80,CHandler,0
Handler 81,CHandler,0
Handler 82,CHandler,0
Handler 83,CHandler,0
Handler 84,CHandler,0
Handler 85,CHandler,0
Handler 86,CHandler,0
Handler 87,CHandler,0
Handler 88,CHandler,0
Handler 89,CHandler,0
Handler 90,CHandler,0
Handler 91,CHandler,0
Handler 92,CHandler,0
Handler 93,CHandler,0
Handler 94,CHandler,0
Handler 95,CHandler,0
Handler 96,CHandler,0
Handler 97,CHandler,0
Handler 98,CHandler,0
Handler 99,CHandler,0
Handler 100,CHandler,0
Handler 101,CHandler,0
Handler 102,CHandler,0
Handler 103,CHandler,0
Handler 104,CHandler,0
Handler 105,CHandler,0
Handler 106,CHandler,0
Handler 107,CHandler,0
Handler 108,CHandler,0
Handler 109,CHandler,0
Handler 110,CHandler,0
Handler 111,CHandler,0
Handler 112,CHandler,0
Handler 113,CHandler,0
Handler 114,CHandler,0
Handler 115,CHandler,0
Handler 116,CHandler,0
Handler 117,CHandler,0
Handler 118,CHandler,0
Handler 119,CHandler,0
Handler 120,CHandler,0
Handler 121,CHandler,0
Handler 122,CHandler,0
Handler 123,CHandler,0
Handler 124,CHandler,0
Handler 125,CHandler,0
Handler 126,CHandler,0
Handler 127,CHandler,0
Handler 128,CHandler,0
Handler 129,CHandler,0
Handler 130,CHandler,0
Handler 131,CHandler,0
Handler 132,CHandler,0
Handler 133,CHandler,0
Handler 134,CHandler,0
Handler 135,CHandler,0
Handler 136,CHandler,0
Handler 137,CHandler,0
Handler 138,CHandler,0
Handler 139,CHandler,0
Handler 140,CHandler,0
Handler 141,CHandler,0
Handler 142,CHandler,0
Handler 143,CHandler,0
Handler 144,CHandler,0
Handler 145,CHandler,0
Handler 146,CHandler,0
Handler 147,CHandler,0
Handler 148,CHandler,0
Handler 149,CHandler,0
Handler 150,CHandler,0
Handler 151,CHandler,0
Handler 152,CHandler,0
Handler 153,CHandler,0
Handler 154,CHandler,0
Handler 155,CHandler,0
Handler 156,CHandler,0
Handler 157,CHandler,0
Handler 158,CHandler,0
Handler 159,CHandler,0
Handler 160,CHandler,0
Handler 161,CHandler,0
Handler 162,CHandler,0
Handler 163,CHandler,0
Handler 164,CHandler,0
Handler 165,CHandler,0
Handler 166,CHandler,0
Handler 167,CHandler,0
Handler 168,CHandler,0
Handler 169,CHandler,0
Handler 170,CHandler,0
Handler 171,CHandler,0
Handler 172,CHandler,0
Handler 173,CHandler,0
Handler 174,CHandler,0
Handler 175,CHandler,0
Handler 176,CHandler,0
Handler 177,CHandler,0
Handler 178,CHandler,0
Handler 179,CHandler,0
Handler 180,CHandler,0
Handler 181,CHandler,0
Handler 182,CHandler,0
Handler 183,CHandler,0
Handler 184,CHandler,0
Handler 185,CHandler,0
Handler 186,CHandler,0
Handler 187,CHandler,0
Handler 188,CHandler,0
Handler 189,CHandler,0
Handler 190,CHandler,0
Handler 191,CHandler,0
Handler 192,CHandler,0
Handler 193,CHandler,0
Handler 194,CHandler,0
Handler 195,CHandler,0
Handler 196,CHandler,0
Handler 197,CHandler,0
Handler 198,CHandler,0
Handler 199,CHandler,0
Handler 200,CHandler,0
Handler 201,CHandler,0
Handler 202,CHandler,0
Handler 203,CHandler,0
Handler 204,CHandler,0
Handler 205,CHandler,0
Handler 206,CHandler,0
Handler 207,CHandler,0
Handler 208,CHandler,0
Handler 209,CHandler,0
Handler 210,CHandler,0
Handler 211,CHandler,0
Handler 212,CHandler,0
Handler 213,CHandler,0
Handler 214,CHandler,0
Handler 215,CHandler,0
Handler 216,CHandler,0
Handler 217,CHandler,0
Handler 218,CHandler,0
Handler 219,CHandler,0
Handler 220,CHandler,0
Handler 221,CHandler,0
Handler 222,CHandler,0
Handler 223,CHandler,0
Handler 224,CHandler,0
Handler 225,CHandler,0
Handler 226,CHandler,0
Handler 227,CHandler,0
Handler 228,CHandler,0
Handler 229,CHandler,0
Handler 230,CHandler,0
Handler 231,CHandler,0
Handler 232,CHandler,0
Handler 233,CHandler,0
Handler 234,CHandler,0
Handler 235,CHandler,0
Handler 236,CHandler,0
Handler 237,CHandler,0
Handler 238,CHandler,0
Handler 239,CHandler,0
Handler 240,CHandler,0
Handler 241,CHandler,0
Handler 242,CHandler,0
Handler 243,CHandler,0
Handler 244,CHandler,0
Handler 245,CHandler,0
Handler 246,CHandler,0
Handler 247,CHandler,0
Handler 248,CHandler,0
Handler 249,CHandler,0
Handler 250,CHandler,0
Handler 251,CHandler,0
Handler 252,CHandler,0
Handler 253,CHandler,0
Handler 254,CHandler,0
Handler 255,CHandler,0
.section ".data"
.global ItrnTable
.align 4096
ItrnTable:
.long AsmHandler0
.long 0
.long AsmHandler1
.long 0
.long AsmHandler2
.long 0
.long AsmHandler3
.long 0
.long AsmHandler4
.long 0
.long AsmHandler5
.long 0
.long AsmHandler6
.long 0
.long AsmHandler7
.long 0
.long AsmHandler8
.long 0
.long AsmHandler9
.long 0
.long AsmHandler10
.long 0
.long AsmHandler11
.long 0
.long AsmHandler12
.long 0
.long AsmHandler13
.long 0
.long AsmHandler14
.long 0
.long AsmHandler15
.long 0
.long AsmHandler16
.long 0
.long AsmHandler17
.long 0
.long AsmHandler18
.long 0
.long AsmHandler19
.long 0
.long AsmHandler20
.long 0
.long AsmHandler21
.long 0
.long AsmHandler22
.long 0
.long AsmHandler23
.long 0
.long AsmHandler24
.long 0
.long AsmHandler25
.long 0
.long AsmHandler26
.long 0
.long AsmHandler27
.long 0
.long AsmHandler28
.long 0
.long AsmHandler29
.long 0
.long AsmHandler30
.long 0
.long AsmHandler31
.long 0
.long AsmHandler32
.long 0
.long AsmHandler33
.long 0
.long AsmHandler34
.long 0
.long AsmHandler35
.long 0
.long AsmHandler36
.long 0
.long AsmHandler37
.long 0
.long AsmHandler38
.long 0
.long AsmHandler39
.long 0
.long AsmHandler40
.long 0
.long AsmHandler41
.long 0
.long AsmHandler42
.long 0
.long AsmHandler43
.long 0
.long AsmHandler44
.long 0
.long AsmHandler45
.long 0
.long AsmHandler46
.long 0
.long AsmHandler47
.long 0
.long AsmHandler48
.long 0
.long AsmHandler49
.long 0
.long AsmHandler50
.long 0
.long AsmHandler51
.long 0
.long AsmHandler52
.long 0
.long AsmHandler53
.long 0
.long AsmHandler54
.long 0
.long AsmHandler55
.long 0
.long AsmHandler56
.long 0
.long AsmHandler57
.long 0
.long AsmHandler58
.long 0
.long AsmHandler59
.long 0
.long AsmHandler60
.long 0
.long AsmHandler61
.long 0
.long AsmHandler62
.long 0
.long AsmHandler63
.long 0
.long AsmHandler64
.long 0
.long AsmHandler65
.long 0
.long AsmHandler66
.long 0
.long AsmHandler67
.long 0
.long AsmHandler68
.long 0
.long AsmHandler69
.long 0
.long AsmHandler70
.long 0
.long AsmHandler71
.long 0
.long AsmHandler72
.long 0
.long AsmHandler73
.long 0
.long AsmHandler74
.long 0
.long AsmHandler75
.long 0
.long AsmHandler76
.long 0
.long AsmHandler77
.long 0
.long AsmHandler78
.long 0
.long AsmHandler79
.long 0
.long AsmHandler80
.long 0
.long AsmHandler81
.long 0
.long AsmHandler82
.long 0
.long AsmHandler83
.long 0
.long AsmHandler84
.long 0
.long AsmHandler85
.long 0
.long AsmHandler86
.long 0
.long AsmHandler87
.long 0
.long AsmHandler88
.long 0
.long AsmHandler89
.long 0
.long AsmHandler90
.long 0
.long AsmHandler91
.long 0
.long AsmHandler92
.long 0
.long AsmHandler93
.long 0
.long AsmHandler94
.long 0
.long AsmHandler95
.long 0
.long AsmHandler96
.long 0
.long AsmHandler97
.long 0
.long AsmHandler98
.long 0
.long AsmHandler99
.long 0
.long AsmHandler100
.long 0
.long AsmHandler101
.long 0
.long AsmHandler102
.long 0
.long AsmHandler103
.long 0
.long AsmHandler104
.long 0
.long AsmHandler105
.long 0
.long AsmHandler106
.long 0
.long AsmHandler107
.long 0
.long AsmHandler108
.long 0
.long AsmHandler109
.long 0
.long AsmHandler110
.long 0
.long AsmHandler111
.long 0
.long AsmHandler112
.long 0
.long AsmHandler113
.long 0
.long AsmHandler114
.long 0
.long AsmHandler115
.long 0
.long AsmHandler116
.long 0
.long AsmHandler117
.long 0
.long AsmHandler118
.long 0
.long AsmHandler119
.long 0
.long AsmHandler120
.long 0
.long AsmHandler121
.long 0
.long AsmHandler122
.long 0
.long AsmHandler123
.long 0
.long AsmHandler124
.long 0
.long AsmHandler125
.long 0
.long AsmHandler126
.long 0
.long AsmHandler127
.long 0
.long AsmHandler128
.long 0
.long AsmHandler129
.long 0
.long AsmHandler130
.long 0
.long AsmHandler131
.long 0
.long AsmHandler132
.long 0
.long AsmHandler133
.long 0
.long AsmHandler134
.long 0
.long AsmHandler135
.long 0
.long AsmHandler136
.long 0
.long AsmHandler137
.long 0
.long AsmHandler138
.long 0
.long AsmHandler139
.long 0
.long AsmHandler140
.long 0
.long AsmHandler141
.long 0
.long AsmHandler142
.long 0
.long AsmHandler143
.long 0
.long AsmHandler144
.long 0
.long AsmHandler145
.long 0
.long AsmHandler146
.long 0
.long AsmHandler147
.long 0
.long AsmHandler148
.long 0
.long AsmHandler149
.long 0
.long AsmHandler150
.long 0
.long AsmHandler151
.long 0
.long AsmHandler152
.long 0
.long AsmHandler153
.long 0
.long AsmHandler154
.long 0
.long AsmHandler155
.long 0
.long AsmHandler156
.long 0
.long AsmHandler157
.long 0
.long AsmHandler158
.long 0
.long AsmHandler159
.long 0
.long AsmHandler160
.long 0
.long AsmHandler161
.long 0
.long AsmHandler162
.long 0
.long AsmHandler163
.long 0
.long AsmHandler164
.long 0
.long AsmHandler165
.long 0
.long AsmHandler166
.long 0
.long AsmHandler167
.long 0
.long AsmHandler168
.long 0
.long AsmHandler169
.long 0
.long AsmHandler170
.long 0
.long AsmHandler171
.long 0
.long AsmHandler172
.long 0
.long AsmHandler173
.long 0
.long AsmHandler174
.long 0
.long AsmHandler175
.long 0
.long AsmHandler176
.long 0
.long AsmHandler177
.long 0
.long AsmHandler178
.long 0
.long AsmHandler179
.long 0
.long AsmHandler180
.long 0
.long AsmHandler181
.long 0
.long AsmHandler182
.long 0
.long AsmHandler183
.long 0
.long AsmHandler184
.long 0
.long AsmHandler185
.long 0
.long AsmHandler186
.long 0
.long AsmHandler187
.long 0
.long AsmHandler188
.long 0
.long AsmHandler189
.long 0
.long AsmHandler190
.long 0
.long AsmHandler191
.long 0
.long AsmHandler192
.long 0
.long AsmHandler193
.long 0
.long AsmHandler194
.long 0
.long AsmHandler195
.long 0
.long AsmHandler196
.long 0
.long AsmHandler197
.long 0
.long AsmHandler198
.long 0
.long AsmHandler199
.long 0
.long AsmHandler200
.long 0
.long AsmHandler201
.long 0
.long AsmHandler202
.long 0
.long AsmHandler203
.long 0
.long AsmHandler204
.long 0
.long AsmHandler205
.long 0
.long AsmHandler206
.long 0
.long AsmHandler207
.long 0
.long AsmHandler208
.long 0
.long AsmHandler209
.long 0
.long AsmHandler210
.long 0
.long AsmHandler211
.long 0
.long AsmHandler212
.long 0
.long AsmHandler213
.long 0
.long AsmHandler214
.long 0
.long AsmHandler215
.long 0
.long AsmHandler216
.long 0
.long AsmHandler217
.long 0
.long AsmHandler218
.long 0
.long AsmHandler219
.long 0
.long AsmHandler220
.long 0
.long AsmHandler221
.long 0
.long AsmHandler222
.long 0
.long AsmHandler223
.long 0
.long AsmHandler224
.long 0
.long AsmHandler225
.long 0
.long AsmHandler226
.long 0
.long AsmHandler227
.long 0
.long AsmHandler228
.long 0
.long AsmHandler229
.long 0
.long AsmHandler230
.long 0
.long AsmHandler231
.long 0
.long AsmHandler232
.long 0
.long AsmHandler233
.long 0
.long AsmHandler234
.long 0
.long AsmHandler235
.long 0
.long AsmHandler236
.long 0
.long AsmHandler237
.long 0
.long AsmHandler238
.long 0
.long AsmHandler239
.long 0
.long AsmHandler240
.long 0
.long AsmHandler241
.long 0
.long AsmHandler242
.long 0
.long AsmHandler243
.long 0
.long AsmHandler244
.long 0
.long AsmHandler245
.long 0
.long AsmHandler246
.long 0
.long AsmHandler247
.long 0
.long AsmHandler248
.long 0
.long AsmHandler249
.long 0
.long AsmHandler250
.long 0
.long AsmHandler251
.long 0
.long AsmHandler252
.long 0
.long AsmHandler253
.long 0
.long AsmHandler254
.long 0
.long AsmHandler255
.long 0
